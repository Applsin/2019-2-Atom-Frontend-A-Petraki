(window.webpackJsonpfullstack_2019_1=window.webpackJsonpfullstack_2019_1||[]).push([[0],[,function(e,a,t){e.exports={container:"FormInput_container__1mGjo",formInput:"FormInput_formInput__1CDjc",attachButton:"FormInput_attachButton__2ixoS",inputButton:"FormInput_inputButton__2UzLN",dropOut:"FormInput_dropOut__2fyVW",dropOutContainer:"FormInput_dropOutContainer__2ygt-",attachItem:"FormInput_attachItem__1vaHt",attachImage:"FormInput_attachImage__21_M-",attachGeo:"FormInput_attachGeo__1PPvS",sendButton:"FormInput_sendButton__22Gjc",micButton:"FormInput_micButton__11YK-",cancelButton:"FormInput_cancelButton__bJpbb",additionsBox:"FormInput_additionsBox__3dD64",additionsBoxUl:"FormInput_additionsBoxUl__1fz_N",image:"FormInput_image__J1Lbo",imageName:"FormInput_imageName__3ZK77",remove:"FormInput_remove__Ij8bW"}},,function(e,a,t){e.exports={wrapper:"Profile_wrapper__l1aal",headerContainer:"Profile_headerContainer__3OGTq",header:"Profile_header__3KTnW",back:"Profile_back__3AkOO",send:"Profile_send__jcmmV",avatar:"Profile_avatar__3XqJk",profile:"Profile_profile__3y5_H",edit:"Profile_edit__1-Gcp",form:"Profile_form__3xqPC",formLabel:"Profile_formLabel__26nnp",inputForm:"Profile_inputForm__2G2h8"}},,function(e,a,t){e.exports={messageWrap:"MessageItem_messageWrap__udvmP",messageItem:"MessageItem_messageItem__3ZnNZ",message:"MessageItem_message__1157w",timestamp:"MessageItem_timestamp__30gC_",attachments:"MessageItem_attachments__15Y8W",attachment:"MessageItem_attachment__3ze9n",geolocation:"MessageItem_geolocation__2Inih",image:"MessageItem_image__1mB4Z",audioStatus:"MessageItem_audioStatus__2GF6X",audioPlay:"MessageItem_audioPlay__1bod5",audioStop:"MessageItem_audioStop__1g6U6"}},,,,,function(e,a,t){e.exports={dialogue:"DialogueItem_dialogue__2rBXY",avatar:"DialogueItem_avatar__9XARq",wrapper:"DialogueItem_wrapper__3lnRQ",text:"DialogueItem_text__1WkGt",name:"DialogueItem_name__1rMup",time:"DialogueItem_time__31wNC",info:"DialogueItem_info__WVGza",message:"DialogueItem_message__3mEch",status:"DialogueItem_status__1zUFk"}},,,function(e,a,t){e.exports={header:"ChatHeader_header__wtf1f",backButton:"ChatHeader_backButton__2kZvs",chatInfo:"ChatHeader_chatInfo__1Q3tD",avatar:"ChatHeader_avatar__W2O5Y",senderInfo:"ChatHeader_senderInfo__1gAM0",searchButton:"ChatHeader_searchButton__30ZIJ",settingsButton:"ChatHeader_settingsButton__SLkJ7"}},,function(e,a,t){e.exports={messageForm:"MessageForm_messageForm__8PdEl",messagesList:"MessageForm_messagesList__2eLXd",header:"MessageForm_header__10-FU",chat:"MessageForm_chat__31JWU",inputForm:"MessageForm_inputForm__Q4V5O",dragNDropArea:"MessageForm_dragNDropArea__3m60l",activeZone:"MessageForm_activeZone__3Ogxo",dragNDropImage:"MessageForm_dragNDropImage__3N1tB"}},,function(e,a,t){e.exports={container:"MainForm_container__1Ac2B",chatDisappear:"MainForm_chatDisappear__2crCV",chatAppearance:"MainForm_chatAppearance__2FfsV"}},,function(e,a,t){e.exports={header:"DialoguesHeader_header__1SGyL",menuBurger:"DialoguesHeader_menuBurger__icB5p",messenger:"DialoguesHeader_messenger__36R73",searchButton:"DialoguesHeader_searchButton__1bBEn"}},function(e,a,t){e.exports={dialogues:"DialogueForm_dialogues__1D1Xl",dialogueList:"DialogueForm_dialogueList__QR6qv",empty:"DialogueForm_empty__ygZ6X"}},,,,,,,,,,,,,function(e,a,t){e.exports={createDialogueButton:"CreateDialogueButton_createDialogueButton__i92_8",pencil:"CreateDialogueButton_pencil__2KVsW"}},,,function(e,a,t){e.exports=t(49)},,,,,function(e,a,t){},,,,,,,function(e,a,t){},function(e,a,t){"use strict";t.r(a);var n=t(0),r=t.n(n),s=t(27),c=(t(41),t(8)),o=t(12);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var i=t(11),l=t.n(i),m=t(16),u=t(28),d=t(29),g=t(34),p=t(30),_=t(35),h=t(20),v=t.n(h),f=t(19),E=t.n(f);function N(){return r.a.createElement("div",{className:E.a.header},r.a.createElement("div",{className:E.a.menuBurger}),r.a.createElement("div",{className:E.a.messenger},"Messenger"),r.a.createElement("div",{className:E.a.searchButton}))}var b=t(10),y=t.n(b),I=r.a.createContext(null);function k(e){var a=e.chat,t=new Date(a.lastMessage.time);return r.a.createElement(I.Consumer,null,(function(e){return r.a.createElement("div",{className:y.a.dialogue},r.a.createElement(c.b,{to:"/profile/".concat(a.id),style:{textDecoration:"none"}},r.a.createElement("div",{className:y.a.avatar})),r.a.createElement("div",{className:y.a.wrapper},r.a.createElement(c.b,{to:"/chat/".concat(a.id),style:{textDecoration:"none",color:"unset"}},r.a.createElement("div",{className:y.a.text},r.a.createElement("div",{className:y.a.name},a.title),r.a.createElement("div",{className:y.a.time},t.toLocaleString("ru",{hour:"numeric",minute:"numeric"}))),r.a.createElement("div",{className:y.a.info},r.a.createElement("div",{className:y.a.message},a.lastMessage.content||"Attachment"),r.a.createElement("div",{className:y.a.status},a.lastMessage.status)))))}))}var D=t(33),B=t.n(D);function F(e){var a=e.createHandler;return r.a.createElement("button",{onClick:a,className:B.a.createDialogueButton})}function S(e){var a=e.chats,t=[];return 0===a.length?t=r.a.createElement("div",{className:v.a.empty},"No messages yet"):a.forEach((function(e){var a=r.a.createElement(k,{chat:e});t.push(a)})),r.a.createElement("div",{className:v.a.dialogues},r.a.createElement(N,null),r.a.createElement("div",{className:v.a.dialogueList},t),r.a.createElement(I.Consumer,null,(function(e){return r.a.createElement(F,{createHandler:e.createHandler.bind(e)})})))}var C=t(7),w=t(15),O=t.n(w),x=t(13),M=t.n(x);function P(e){var a=e.details,t=e.clickBack;return r.a.createElement("div",{className:M.a.header},r.a.createElement(c.b,{to:"/"},r.a.createElement("div",{onClick:t,className:M.a.backButton})),r.a.createElement("div",{className:M.a.chatInfo},r.a.createElement(c.b,{to:"/profile/".concat(a.id)},r.a.createElement("div",{className:M.a.avatar})),r.a.createElement("div",{className:M.a.senderInfo},r.a.createElement("div",null,a.title),r.a.createElement("div",null,"last seen at 12:00"))),r.a.createElement("div",{className:M.a.searchButton}),r.a.createElement("div",{className:M.a.settingsButton}))}var L=t(21),j=t(1),R=t.n(j);function H(){return(H=Object(m.a)(l.a.mark((function e(a){var t,n,r,s,c=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=c.length>1&&void 0!==c[1]?c[1]:null,n=c.length>2&&void 0!==c[2]?c[2]:null,r=c.length>3&&void 0!==c[3]?c[3]:null,a?(a.start(),t&&t(),s=[],a.addEventListener("stop",(function(){var e=new Blob(s,{type:a.mimeType}),t=URL.createObjectURL(e);s=[],r&&r(t,e)})),a.addEventListener("dataavailable",(function(e){s.push(e.data)}))):n&&n();case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e){var a=r.a.useRef(null),t=e.messageHandler,n=e.requireRecorder,s=e.mediaRecorder,c=Object(C.a)(e.dragFiles,2),o=c[0],i=c[1],l=r.a.useState(null),m=Object(C.a)(l,2),u=m[0],d=m[1],g=r.a.useState(null),p=Object(C.a)(g,2),_=p[0],h=p[1],v=r.a.useState("mic"),f=Object(C.a)(v,2),E=f[0],N=f[1],b=r.a.useState(!1),y=Object(C.a)(b,2),I=y[0],k=y[1],D=null,B=null,F=r.a.useRef(null),S=function(){var e=a.current.value.trim();(_||""!==e)&&(a.current.value="",t(e,null,null,_)),h(null)},w=function(e){var a=_.list;a.splice(e,1),a.length?h({type:_.type,list:a}):h(null)};if(o){var O=_||{};O.type="image",O.list=[{name:o.name,path:window.URL.createObjectURL(o),file:o}],O!==_&&h(O),i(null)}var x=function(e){I!==e&&k(e)};I&&"cancel"!==E?N("cancel"):!I&&a.current&&""!==a.current.value||_?"send"!==E&&N("send"):I||"mic"===E||N("mic");return _&&(D={height:"100px"},B=_.list.map((function(e,a){return r.a.createElement(A,{key:a,remove:w.bind(null,a),type:_.type,addition:e})}))),r.a.createElement("div",{className:R.a.container},r.a.createElement("div",{className:R.a.formInput},r.a.createElement("div",{onClick:function(){!u&&d({height:"50px"}),u&&d(null)},className:R.a.attachButton}),r.a.createElement("input",{onChange:function(e){e.target.value.length>0?N("send"):0===e.target.value.length&&N("mic")},onKeyPress:function(e){13===e.charCode&&S()},ref:a,placeholder:"Enter message..."}),r.a.createElement(J,{cancel:function(){!function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e&&e.stop(),a&&a()}(s,(function(){x(!1)}))},record:function(){n().then((function(e){!function(e){H.apply(this,arguments)}(e,(function(){x(!0)}),(function(){x(!1)}),(function(e,a){h({type:"audio",list:[{path:e,file:a}]})}))})).catch(console.log)},submit:S,type:E}),r.a.createElement("div",{className:R.a.dropOut,style:u},r.a.createElement("div",{className:R.a.dropOutContainer},r.a.createElement("div",{onClick:function(){d(null),F.current.click()},className:"".concat(R.a.attachItem," ").concat(R.a.attachImage)},r.a.createElement("input",{onChange:function(e){!function(e,a){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=e.target.files;if(!n.length)return!1;var r=!1;n=Object(L.a)(n).map((function(e){return e.size>8388608&&(r=!0),{name:e.name,path:window.URL.createObjectURL(e),file:e}})),r?t&&t("Its too big!!!"):(_&&(n=[].concat(Object(L.a)(_.list),Object(L.a)(n))),n.length>10&&(n=n.slice(0,10)),a(n))}(e,(function(e){h({type:"image",list:e})}))},ref:F,type:"file",multiple:!0,style:{display:"none"}})),r.a.createElement("div",{onClick:function(){d(null),function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if("geolocation"in navigator){navigator.geolocation.getCurrentPosition(e,a,{enableHighAccuracy:!0,maximumAge:3e4,timeout:27e3})}else a&&a("Permisition denied")}((function(e){var a=e.coords,t=a.latitude,n=a.longitude,r="https://yandex.ru/maps/?ll=".concat(n,"%2C").concat(t,"&z=15");h({type:"geolocation",list:[{path:r,latitude:t,longitude:n}]})}))},className:"".concat(R.a.attachItem," ").concat(R.a.attachGeo)})))),r.a.createElement("div",{style:D,className:R.a.additionsBox},r.a.createElement("ul",{className:R.a.additionsBoxUl},B)))}function A(e){var a=e.remove,t=e.type,n=e.addition,s={backgroundRepeat:"no-repeat",backgroundPosition:"center center",height:"50px"};switch(t){case"audio":s.backgroundImage="url(https://image.flaticon.com/icons/svg/117/117114.svg)";break;case"image":s.backgroundImage="url(".concat(n.path,")");break;case"geolocation":s.backgroundImage="url(https://image.flaticon.com/icons/svg/854/854878.svg)"}return r.a.createElement("li",null,r.a.createElement("div",{onClick:a,className:R.a.remove},"x"),r.a.createElement("div",{style:s,className:R.a.image}))}function J(e){var a=e.submit,t=e.record,n=e.cancel,s=null;switch(e.type){case"mic":s=r.a.createElement("div",{onClick:t,className:"".concat(R.a.inputButton," ").concat(R.a.micButton)});break;case"send":s=r.a.createElement("div",{onClick:a,className:"".concat(R.a.inputButton," ").concat(R.a.sendButton)});break;case"cancel":s=r.a.createElement("div",{onClick:n,className:"".concat(R.a.inputButton," ").concat(R.a.cancelButton)})}return s}var W=t(5),G=t.n(W);function Z(e){var a=e.inner,t=a.content,n=a.time,s=new Date(n),c=!1,o=[];if("attachments"in e.inner){var i=e.inner.attachments;c=!0,i.list.forEach((function(e){var a=r.a.createElement(q,{type:i.type,attachment:e});o.push(a)}))}return r.a.createElement("div",{className:G.a.messageWrap},r.a.createElement("div",{className:G.a.messageItem},r.a.createElement("div",{className:G.a.inner},r.a.createElement("div",{className:G.a.message},t),r.a.createElement("div",{className:G.a.attachments},c&&o)),r.a.createElement("div",{className:G.a.timestamp},s.toLocaleString("ru",{hour:"numeric",minute:"numeric"}))))}function q(e){var a=e.attachment,t=a.name,n=a.path,s=e.type,c=r.a.useState(!1),o=Object(C.a)(c,2),i=o[0],l=o[1],m=r.a.useRef(null),u=null;switch(s){case"geolocation":var d=e.attachment,g=d.latitude,p=d.longitude,_="https://static-maps.yandex.ru/1.x/?ll=".concat(p,",").concat(g,"&spn=0.016457,0.00619&l=map&size=300,300"),h={backgroundRepeat:"no-repeat",backgroundSize:"cover",backgroundPosition:"center center",height:"300px",width:"300px"};h.backgroundImage="url(".concat(_,")"),u=r.a.createElement("div",null,r.a.createElement("a",{href:n,target:"_blank",rel:"noopener noreferrer"},r.a.createElement("div",{style:h,className:"".concat(G.a.attachment)})));break;case"image":u=r.a.createElement("img",{alt:t,src:n,className:G.a.image});break;case"audio":var v=i?G.a.audioStop:G.a.audioPlay;u=r.a.createElement("div",{onClick:function(){i?(m.current.pause(),l(!1)):(m.current.play(),l(!0))}},r.a.createElement("div",{className:G.a.attachment},r.a.createElement("div",{className:"".concat(G.a.audioStatus," ").concat(v)})),r.a.createElement("audio",{onEnded:function(){l(!1)},ref:m,src:n}))}return u}function z(e){var a=e.messages,t=e.details,n=e.style,s=r.a.useState(!1),c=Object(C.a)(s,2),o=c[0],i=c[1],l=r.a.useState(null),m=Object(C.a)(l,2),u=m[0],d=m[1];if(null===t)return"";var g=[];return a.forEach((function(e){var a=r.a.createElement(Z,{inner:e});g.push(a)})),r.a.createElement("div",{onDrop:function(e){e.preventDefault(),e.stopPropagation(),i(!1),d(e.dataTransfer.files[0])},onDragOver:function(e){e.preventDefault(),e.stopPropagation(),i(!0)},onDragLeave:function(){i(!1)},style:n,className:O.a.messageForm},r.a.createElement("input",{className:"".concat(O.a.dragNDropArea," ").concat(o&&O.a.activeZone),type:"file",accept:"image/*"}),r.a.createElement(I.Consumer,null,(function(e){return r.a.createElement(P,{details:t,clickBack:e.closeDialogue.bind(e,"MessageForm")})})),r.a.createElement("div",{className:O.a.chat},r.a.createElement("div",{className:O.a.messagesList},g)),r.a.createElement("div",{className:O.a.inputForm},r.a.createElement(I.Consumer,null,(function(e){return r.a.createElement(U,{requireRecorder:e.requireRecorder.bind(e),mediaRecorder:e.state.mediaRecorder,messageHandler:e.messageHandler.bind(e),dragFiles:[u,d]})}))))}var V=t(3),X=t.n(V);function K(e){var a=e.style;return r.a.createElement("div",{className:X.a.wrapper,style:a},r.a.createElement("div",{className:X.a.headerContainer},r.a.createElement("div",{className:X.a.header},r.a.createElement(c.b,{to:"/",style:{textDecoration:"none",color:"unset"}},r.a.createElement("div",{className:X.a.back})),r.a.createElement("div",{className:X.a.edit},"Edit Profile"),r.a.createElement("div",{className:X.a.submit}))),r.a.createElement("div",{className:X.a.profile},r.a.createElement("div",{className:X.a.avatar}),r.a.createElement("div",{className:X.a.form},r.a.createElement("div",{className:X.a.formLabel},"Full name"),r.a.createElement("input",{className:X.a.inputForm,placeholder:"Name Placeholder"})),r.a.createElement("div",{className:X.a.form},r.a.createElement("div",{className:X.a.formLabel},"Username"),r.a.createElement("input",{className:X.a.inputForm,placeholder:"@test"})),r.a.createElement("div",{className:X.a.form},r.a.createElement("div",{className:X.a.formLabel},"Info"),r.a.createElement("input",{className:X.a.inputForm,placeholder:"Info Placeholder"}))))}function T(){return Q.apply(this,arguments)}function Q(){return(Q=Object(m.a)(l.a.mark((function e(){var a,t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=null,e.prev=1,t={audio:!0},e.next=5,navigator.mediaDevices.getUserMedia(t);case 5:n=e.sent,a=new MediaRecorder(n),e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(1),new Error(e.t0);case 12:return e.abrupt("return",a);case 13:case"end":return e.stop()}}),e,null,[[1,9]])})))).apply(this,arguments)}var Y=t(17),$=t.n(Y),ee=function(e){function a(e){var t;Object(u.a)(this,a);var n=(t=Object(g.a)(this,Object(p.a)(a).call(this,e))).parseStorage();return t.state={chats:n.chats,messages:n.messages,chatCounter:n.chatCounter,currentDialogue:null,mediaRecorder:null,frameStyles:{MessageForm:null,Profile:null}},t}return Object(_.a)(a,e),Object(d.a)(a,[{key:"parseStorage",value:function(){var e={chats:JSON.parse(localStorage.getItem("chats")),messages:JSON.parse(localStorage.getItem("messages")),chatCounter:JSON.parse(localStorage.getItem("chatCounter"))};return e.chats||(e.chats=[],e.messages={},e.chatCounter=0),e}},{key:"requireRecorder",value:function(){var e=Object(m.a)(l.a.mark((function e(){var a=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.state.mediaRecorder){e.next=2;break}return e.abrupt("return",this.state.mediaRecorder);case 2:return e.abrupt("return",T().then((function(e){return a.setState({mediaRecorder:e}),e})).catch((function(e){throw new Error(e)})));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"openDialogue",value:function(e){var a=this.state;a.frameStyles.MessageForm={animationName:$.a.chatAppearance},a.currentDialogue=e,a!==this.state&&this.setState(a)}},{key:"closeDialogue",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=this.state;e?a.frameStyles[e]={animationName:$.a.chatDisappear}:Object.keys(a.frameStyles).forEach((function(e){a.frameStyles[e]={animationName:$.a.chatDisappear}})),a!==this.state&&this.setState(a)}},{key:"messageHandler",value:function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=this.state,s=r.currentDialogue,c=r.messages;c||(c={}),t&&(c[(s=t)-1]=[]);var o={id:"test",content:e,amISender:!0,time:a||new Date,status:"sent"};if(n){o.attachments=n,!0;var i=new FormData;i.append(Attr.type,n.file),fetch("https://tt-front.now.sh/upload",{method:"POST",body:i}).then((function(){})).catch(console.log)}c[s-1].push(o),this.setState(c),t||this.setLastMessage(),localStorage.setItem("messages",JSON.stringify(c))}},{key:"createHandler",value:function(){var e=this.state,a=e.chats,t=e.chatCounter,n=prompt("Enter person's name"),r=prompt("Write a message");t+=1,this.messageHandler(r,new Date,t);var s=this.state.messages[t-1];a.push({id:t,title:n,is_group:!1,host:"Vladimir Carpa",lastMessage:s[s.length-1]}),this.setState({chats:a,chatCounter:t}),this.setLastMessage(t),localStorage.setItem("chats",JSON.stringify(a)),localStorage.setItem("chatCounter",JSON.stringify(t))}},{key:"setLastMessage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=this.state,t=a.messages,n=a.chats,r=this.state.currentDialogue;e&&(r=e);var s=t[r-1];n[r-1].lastMessage=s[s.length-1],this.setState(n),localStorage.setItem("chats",JSON.stringify(n))}},{key:"openProfile",value:function(){var e=this.state;e.frameStyles.Profile={animationName:$.a.chatAppearance},e!==this.state&&this.setState(e)}},{key:"pageRouter",value:function(){var e=this.props.location.pathname;switch(!0){case/chat\/\d\/?$/.test(e):var a=parseInt(e.match(/\d+/),10);this.openDialogue(a);break;case/profile\/\d\/?$/.test(e):this.openProfile();break;default:this.closeDialogue()}}},{key:"render",value:function(){this.pageRouter();var e=this.state;return r.a.createElement(I.Provider,{value:this},r.a.createElement("div",{className:$.a.container},r.a.createElement(S,{chats:e.chats}),r.a.createElement(z,{style:e.frameStyles.MessageForm,details:e.currentDialogue&&e.chats[e.currentDialogue-1],messages:e.currentDialogue&&e.messages[e.currentDialogue-1]}),r.a.createElement(K,{style:e.frameStyles.Profile})))}}]),a}(r.a.Component);t(48);Object(s.render)(r.a.createElement(c.a,null,r.a.createElement(o.a,{path:"/",component:ee})),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}],[[36,1,2]]]);
//# sourceMappingURL=main.47988a41.chunk.js.map